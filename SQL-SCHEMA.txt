CREATE SCHEMA `quiz` ;

CREATE TABLE quiz.user(
ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT, 
FIRST_NAME  varchar(255) not null,
LAST_NAME varchar(255),
EMAIL_ID varchar(100) not null, 
PASSWORD varchar(255) not null,   
PHONE_NUMBER varchar(15) not null,
CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP);

CREATE TABLE quiz.category(
CAT_ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT, 
CAT_NAME  varchar(255) not null,
CAT_DESC  varchar(255) ,
CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP);

CREATE TABLE quiz.quiz(
QUIZ_ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
CAT_ID BIGINT NOT NULL, 
QUIZ_NAME  varchar(255) not null,
QUIZ_DESC  varchar(255) ,
DIFFICULTY_LEVEL  varchar(255),
DURATION INT NOT NULL,
CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT CAT_ID
    FOREIGN KEY (CAT_ID)
    REFERENCES quiz.category (CAT_ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE);

CREATE TABLE quiz.quiz_result (
  QUIZ_RESULT_ID BIGINT NOT NULL AUTO_INCREMENT,
  QUIZ_ID BIGINT NOT NULL,
  USER_ID BIGINT NOT NULL,
  RESULT TINYINT,
  PERCENTAGE DECIMAL NULL,
  STATUS VARCHAR(45) NOT NULL,
  ATTEMPT INT NOT NULL,
  CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (QUIZ_RESULT_ID),
  CONSTRAINT USER_ID
    FOREIGN KEY (USER_ID)
    REFERENCES quiz.user (ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT QUIZ_ID
    FOREIGN KEY (QUIZ_ID)
    REFERENCES quiz.QUIZ (QUIZ_ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE);

CREATE TABLE quiz.result_history (
  QUIZ_ID BIGINT NOT NULL,
  USER_ID BIGINT NOT NULL,
  ATTEMPT BIGINT NOT NULL,
  RESULT TINYINT NOT NULL,
  PERCENTAGE DECIMAL NOT NULL,
CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (QUIZ_ID, USER_ID, ATTEMPT));


CREATE TABLE quiz.question (
  QUESTION_ID BIGINT NOT NULL AUTO_INCREMENT,
  QUESTION_DESCRIPTION VARCHAR(255) NOT NULL,
  CHOICE1 VARCHAR(255) NOT NULL,
  CHOICE2 VARCHAR(255) NOT NULL,
  CHOICE3 VARCHAR(255) NULL,
  CHOICE4 VARCHAR(255) NULL,
  QUESTION_TYPE VARCHAR(45) NOT NULL,
  QUIZ_ID BIGINT NOT NULL,
CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (QUESTION_ID),
  INDEX QUIZ_ID_idx (QUIZ_ID ASC),
  CONSTRAINT QUE_QUIZ_ID
    FOREIGN KEY (QUIZ_ID)
    REFERENCES quiz.quiz (QUIZ_ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE);

	
CREATE TABLE quiz.answer(
  ANSWER_ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  QUESTION_ID BIGINT NOT NULL ,
  ANSWER VARCHAR(10) NOT NULL,
CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT QUESTION_ID
    FOREIGN KEY (QUESTION_ID)
    REFERENCES quiz.question (QUESTION_ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE);
